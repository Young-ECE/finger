# 传感器数据实时可视化工具

这是一个基于PyQt6的实时传感器数据可视化界面，用于监控和分析多种传感器数据。

## 功能特性

- ✅ 实时从USB CDC串口读取传感器数据
- ✅ 支持14个数据通道的实时绘图
- ✅ 分类显示：空气质量、光学、温湿度、音频
- ✅ 数据缓冲和历史记录（最多500个数据点）
- ✅ 数据保存为CSV文件
- ✅ 友好的GUI界面

## 传感器数据

该工具支持以下传感器数据：

### 空气质量 (ENS160)
- AQI - 空气质量指数
- TVOC - 总挥发性有机物 (ppb)
- eCO2 - 等效CO2浓度 (ppm)

### 光学传感器 (VCNL4040)
- ALS - 环境光强度
- PS - 接近传感器值

### 温湿度传感器 (HDC302x × 4)
- T1-T4 - 四组温度值 (°C)
- H1-H4 - 四组湿度值 (%)

### 音频传感器
- Audio - 麦克风音频处理结果

## 安装依赖

```bash
pip install -r requirements.txt
```

或手动安装：

```bash
pip install PySide6 pyqtgraph pyserial numpy
```

## 使用方法

### 1. 启动程序

```bash
python sensor_visualizer.py
```

或者设置为可执行：

```bash
chmod +x sensor_visualizer.py
./sensor_visualizer.py
```

### 2. 连接设备

1. 将STM32设备通过USB连接到电脑
2. 点击"刷新"按钮扫描可用串口
3. 从下拉菜单选择对应的串口
4. 点击"连接"按钮开始接收数据

### 3. 查看数据

连接成功后，实时曲线会自动更新显示各传感器数据。

### 4. 保存数据

点击"保存数据"按钮可将当前缓冲区的数据保存为CSV文件，方便后续分析。

### 5. 清空数据

点击"清空数据"可清除所有历史数据，重新开始记录。

## 数据格式

USB传输的数据格式为CSV（逗号分隔），每行包含14个字段：

```
aqi,tvoc,eco2,als,ps,T1,H1,T2,H2,T3,H3,T4,H4,audio
```

示例：
```
3,250,450,1234,567,245,650,246,652,244,648,245,651,1024
```

注意：温度和湿度值需除以10得到实际值（程序已自动处理）。

## 界面布局

```
┌─────────────────────────────────────────────────────┐
│  串口选择 | 刷新 | 连接 | 清空 | 保存 | 状态         │
├─────────────────────────────────────────────────────┤
│  [AQI图]      [TVOC图]      [eCO2图]               │
├─────────────────────────────────────────────────────┤
│  [环境光图]   [接近图]      [音频图]               │
├─────────────────────────────────────────────────────┤
│  [温度4合1图]              [湿度4合1图]            │
└─────────────────────────────────────────────────────┘
```

## 系统要求

- Python 3.8+
- Linux / Windows / macOS
- USB CDC驱动（Linux通常自动识别为 `/dev/ttyACM*`）

## 故障排除

### 串口权限问题（Linux）

如果遇到串口权限错误，将用户添加到 `dialout` 组：

```bash
sudo usermod -a -G dialout $USER
# 需要重新登录系统使权限生效
```

### 串口未显示

- 确认设备已正确连接
- 检查USB CDC驱动是否安装
- 使用 `ls /dev/ttyACM*` 或 `ls /dev/ttyUSB*` 查看可用串口

### 数据解析错误

- 确认STM32发送的数据格式正确（14个字段，逗号分隔）
- 检查波特率设置（默认115200）

## 许可证

本项目代码可自由使用和修改。

## 作者

传感器固件工程配套可视化工具
